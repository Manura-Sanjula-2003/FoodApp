<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Reset</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script defer src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #17a2b8;
      height: 100vh;
    }
    #login .container #login-row #login-column #login-box {
      margin-top: 120px;
      max-width: 600px;
      height: 320px;
      border: 1px solid #9C9C9C;
      background-color: #EAEAEA;
    }
    #login .container #login-row #login-column #login-box #login-form {
      padding: 20px;
    }
    #login .container #login-row #login-column #login-box #login-form #register-link {
      margin-top: -85px;
    }

    </style>
</head>
<body>
<div id="login">
    <h3 class="text-center text-white pt-5">Password Reset Form </h3>
    <div class="container">
        <div id="login-row" class="row justify-content-center align-items-center">
            <div id="login-column" class="col-md-6">
                <div id="login-box" class="col-md-12">
                    <form id="login-form" class="form" action="" method="post">
                        <h3 class="text-center text-info">Enter New Password</h3>
                        <div class="form-group">
                            <label for="new_password" class="text-info">New Password:</label><br>
                            <input type="password" name="password" id="new_password" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="confirm_password" class="text-info">Confirm New Password:</label><br>
                            <input type="password" name="password" id="confirm_password" class="form-control">
                        </div>
                        <div class="form-group">

                            <input type="submit" name="submit" class="btn btn-info btn-md" value="submit">
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script language="javascript">
function isEmpty(str) {
    return (!str || 0 === str.trim().length);
}

function saveNewPassword()
{
    var urlParams = new URLSearchParams(location.search);

    if (!urlParams.has('token') || isEmpty(urlParams.get('token')))
    {
        alert("Missing the required Token");
        return;
    }

    var tokenValue = urlParams.get('token');

    var password_one = document.getElementById("new_password").value;
    var password_two = document.getElementById("confirm_password").value;

    if (isEmpty(password_one))
    {
        alert("Password cannot be empty");
        return;
    }

    if (password_one !== password_two)
    {
        alert("Passwords do not match");
        return;
    }


    $.ajaxSetup({
        "contentType": "application/json"
    });

    var dataPayload = { "token": tokenValue, "password": password_one };

    $.post('http://localhost:8080/users/password-reset', JSON.stringify(dataPayload))
            .done(function (response) {
                document.getElementById("password_one").value="";
                document.getElementById("password_two").value="";

                if (response["operationResult"] === "SUCCESS")
                {
                    $("#not-successful-result").attr("style", "display: none !important;");
                    $("#successful-result").attr("style", "display: block !important;");

                } else {
                    $("#successful-result").attr("style", "display: none !important;");
                    $("#not-successful-result").attr("style", "display: block !important;");
                }

            });
}

</script>


</body>
</html>





